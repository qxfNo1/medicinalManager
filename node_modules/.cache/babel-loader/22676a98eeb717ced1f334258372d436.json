{"ast":null,"code":"var _jsxFileName = \"D:\\\\studyFiles\\\\\\u524D\\u7AEF\\\\react-guli\\\\code\\\\admin-client_final\\\\src\\\\pages\\\\product\\\\rich-text-editor.jsx\";\n\n/*\n用来指定商品详情的富文本编辑器组件\n */\nimport React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport { EditorState, convertToRaw, ContentState } from 'draft-js';\nimport { Editor } from 'react-draft-wysiwyg';\nimport draftToHtml from 'draftjs-to-html';\nimport htmlToDraft from 'html-to-draftjs';\nimport 'react-draft-wysiwyg/dist/react-draft-wysiwyg.css';\nexport default class RichTextEditor extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      editorState: EditorState.createEmpty() // 创建一个没有内容的编辑对象\n\n    };\n\n    this.onEditorStateChange = editorState => {\n      console.log('onEditorStateChange()');\n      this.setState({\n        editorState\n      });\n    };\n\n    this.getDetail = () => {\n      // 返回输入数据对应的html格式的文本\n      return draftToHtml(convertToRaw(this.state.editorState.getCurrentContent()));\n    };\n\n    this.uploadImageCallBack = file => {\n      return new Promise((resolve, reject) => {\n        const xhr = new XMLHttpRequest();\n        xhr.open('POST', '/manage/img/upload');\n        const data = new FormData();\n        data.append('image', file);\n        xhr.send(data);\n        xhr.addEventListener('load', () => {\n          const response = JSON.parse(xhr.responseText);\n          const url = response.data.url; // 得到图片的url\n\n          resolve({\n            data: {\n              link: url\n            }\n          });\n        });\n        xhr.addEventListener('error', () => {\n          const error = JSON.parse(xhr.responseText);\n          reject(error);\n        });\n      });\n    };\n\n    const html = this.props.detail;\n\n    if (html) {\n      // 如果有值, 根据html格式字符串创建一个对应的编辑对象\n      const contentBlock = htmlToDraft(html);\n      const contentState = ContentState.createFromBlockArray(contentBlock.contentBlocks);\n      const editorState = EditorState.createWithContent(contentState);\n      this.state = {\n        editorState\n      };\n    } else {\n      this.state = {\n        editorState: EditorState.createEmpty() // 创建一个没有内容的编辑对象\n\n      };\n    }\n  }\n  /*\n  输入过程中实时的回调\n   */\n\n\n  render() {\n    const {\n      editorState\n    } = this.state;\n    return /*#__PURE__*/React.createElement(Editor, {\n      editorState: editorState,\n      editorStyle: {\n        border: '1px solid black',\n        minHeight: 200,\n        paddingLeft: 10\n      },\n      onEditorStateChange: this.onEditorStateChange,\n      toolbar: {\n        image: {\n          uploadCallback: this.uploadImageCallBack,\n          alt: {\n            present: true,\n            mandatory: true\n          }\n        }\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 80,\n        columnNumber: 7\n      }\n    });\n  }\n\n}\nRichTextEditor.propTypes = {\n  detail: PropTypes.string\n};","map":{"version":3,"sources":["D:/studyFiles/前端/react-guli/code/admin-client_final/src/pages/product/rich-text-editor.jsx"],"names":["React","Component","PropTypes","EditorState","convertToRaw","ContentState","Editor","draftToHtml","htmlToDraft","RichTextEditor","constructor","props","state","editorState","createEmpty","onEditorStateChange","console","log","setState","getDetail","getCurrentContent","uploadImageCallBack","file","Promise","resolve","reject","xhr","XMLHttpRequest","open","data","FormData","append","send","addEventListener","response","JSON","parse","responseText","url","link","error","html","detail","contentBlock","contentState","createFromBlockArray","contentBlocks","createWithContent","render","border","minHeight","paddingLeft","image","uploadCallback","alt","present","mandatory","propTypes","string"],"mappings":"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","sourcesContent":["/*\n用来指定商品详情的富文本编辑器组件\n */\nimport React, {Component} from 'react'\nimport PropTypes from 'prop-types'\nimport {EditorState, convertToRaw, ContentState} from 'draft-js'\nimport {Editor} from 'react-draft-wysiwyg'\nimport draftToHtml from 'draftjs-to-html'\nimport htmlToDraft from 'html-to-draftjs'\nimport 'react-draft-wysiwyg/dist/react-draft-wysiwyg.css'\n\n\nexport default class RichTextEditor extends Component {\n  \n  static propTypes = {\n    detail: PropTypes.string\n  }\n  \n  state = {\n    editorState: EditorState.createEmpty(), // 创建一个没有内容的编辑对象\n  }\n\n  constructor(props) {\n    super(props)\n    const html = this.props.detail\n    if (html) { // 如果有值, 根据html格式字符串创建一个对应的编辑对象\n      const contentBlock = htmlToDraft(html)\n      const contentState = ContentState.createFromBlockArray(contentBlock.contentBlocks)\n      const editorState = EditorState.createWithContent(contentState)\n      this.state = {\n        editorState,\n      }\n    } else {\n      this.state = {\n        editorState: EditorState.createEmpty(), // 创建一个没有内容的编辑对象\n      }\n    }\n\n  }\n\n  /*\n  输入过程中实时的回调\n   */\n  onEditorStateChange = (editorState) => {\n    console.log('onEditorStateChange()')\n    this.setState({\n      editorState,\n    })\n  }\n\n  getDetail = () => {\n    // 返回输入数据对应的html格式的文本\n    return draftToHtml(convertToRaw(this.state.editorState.getCurrentContent()))\n  }\n\n  uploadImageCallBack = (file) => {\n    return new Promise(\n      (resolve, reject) => {\n        const xhr = new XMLHttpRequest()\n        xhr.open('POST', '/manage/img/upload')\n        const data = new FormData()\n        data.append('image', file)\n        xhr.send(data)\n        xhr.addEventListener('load', () => {\n          const response = JSON.parse(xhr.responseText)\n          const url = response.data.url // 得到图片的url\n          resolve({data: {link: url}})\n        })\n        xhr.addEventListener('error', () => {\n          const error = JSON.parse(xhr.responseText)\n          reject(error)\n        })\n      }\n    )\n  }\n\n  render() {\n    const {editorState} = this.state\n    return (\n      <Editor\n        editorState={editorState}\n        editorStyle={{border: '1px solid black', minHeight: 200, paddingLeft: 10}}\n        onEditorStateChange={this.onEditorStateChange}\n        toolbar={{\n          image: { uploadCallback: this.uploadImageCallBack, alt: { present: true, mandatory: true } },\n        }}\n      />\n    )\n  }\n}"]},"metadata":{},"sourceType":"module"}