{"ast":null,"code":"import \"antd/es/card/style\";\nimport _Card from \"antd/es/card\";\nimport \"antd/es/table/style\";\nimport _Table from \"antd/es/table\";\nimport \"antd/es/button/style\";\nimport _Button from \"antd/es/button\";\nimport \"antd/es/message/style\";\nimport _message from \"antd/es/message\";\nimport \"antd/es/modal/style\";\nimport _Modal from \"antd/es/modal\";\nvar _jsxFileName = \"D:\\\\studyFiles\\\\\\u524D\\u7AEF\\\\react-guli\\\\code\\\\admin-client_final\\\\src\\\\pages\\\\user\\\\user.jsx\";\nimport React, { Component } from 'react';\nimport { formateDate } from \"../../utils/dateUtils\";\nimport LinkButton from \"../../components/link-button/index\";\nimport { reqDeleteUser, reqUsers, reqAddOrUpdateUser } from \"../../api/index\";\nimport UserForm from './user-form';\n/*\n用户路由\n */\n\nexport default class User extends Component {\n  constructor(...args) {\n    super(...args);\n    this.state = {\n      users: [],\n      // 所有用户列表\n      roles: [],\n      // 所有角色列表\n      isShow: false // 是否显示确认框\n\n    };\n\n    this.initColumns = () => {\n      this.columns = [{\n        title: '用户名',\n        dataIndex: 'username'\n      }, {\n        title: '邮箱',\n        dataIndex: 'email'\n      }, {\n        title: '电话',\n        dataIndex: 'phone'\n      }, {\n        title: '注册时间',\n        dataIndex: 'create_time',\n        render: formateDate\n      }, {\n        title: '所属角色',\n        dataIndex: 'role_id',\n        render: role_id => this.roleNames[role_id]\n      }, {\n        title: '操作',\n        render: user => /*#__PURE__*/React.createElement(\"span\", {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 53,\n            columnNumber: 11\n          }\n        }, /*#__PURE__*/React.createElement(LinkButton, {\n          onClick: () => this.showUpdate(user),\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 54,\n            columnNumber: 13\n          }\n        }, \"\\u4FEE\\u6539\"), /*#__PURE__*/React.createElement(LinkButton, {\n          onClick: () => this.deleteUser(user),\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 55,\n            columnNumber: 13\n          }\n        }, \"\\u5220\\u9664\"))\n      }];\n    };\n\n    this.initRoleNames = roles => {\n      const roleNames = roles.reduce((pre, role) => {\n        pre[role._id] = role.name;\n        return pre;\n      }, {}); // 保存\n\n      this.roleNames = roleNames;\n    };\n\n    this.showAdd = () => {\n      this.user = null; // 去除前面保存的user\n\n      this.setState({\n        isShow: true\n      });\n    };\n\n    this.showUpdate = user => {\n      this.user = user; // 保存user\n\n      this.setState({\n        isShow: true\n      });\n    };\n\n    this.deleteUser = user => {\n      _Modal.confirm({\n        title: `确认删除${user.username}吗?`,\n        onOk: async () => {\n          const result = await reqDeleteUser(user._id);\n\n          if (result.status === 0) {\n            _message.success('删除用户成功!');\n\n            this.getUsers();\n          }\n        }\n      });\n    };\n\n    this.addOrUpdateUser = async () => {\n      this.setState({\n        isShow: false\n      }); // 1. 收集输入数据\n\n      const user = this.form.getFieldsValue();\n      this.form.resetFields(); // 如果是更新, 需要给user指定_id属性\n\n      if (this.user) {\n        user._id = this.user._id;\n      } // 2. 提交添加的请求\n\n\n      const result = await reqAddOrUpdateUser(user); // 3. 更新列表显示\n\n      if (result.status === 0) {\n        _message.success(`${this.user ? '修改' : '添加'}用户成功`);\n\n        this.getUsers();\n      }\n    };\n\n    this.getUsers = async () => {\n      const result = await reqUsers();\n\n      if (result.status === 0) {\n        const {\n          users,\n          roles\n        } = result.data;\n        this.initRoleNames(roles);\n        this.setState({\n          users,\n          roles\n        });\n      }\n    };\n  }\n\n  componentWillMount() {\n    this.initColumns();\n  }\n\n  componentDidMount() {\n    this.getUsers();\n  }\n\n  render() {\n    const {\n      users,\n      roles,\n      isShow\n    } = this.state;\n    const user = this.user || {};\n    const title = /*#__PURE__*/React.createElement(_Button, {\n      type: \"primary\",\n      onClick: this.showAdd,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 158,\n        columnNumber: 19\n      }\n    }, \"\\u521B\\u5EFA\\u7528\\u6237\");\n    return /*#__PURE__*/React.createElement(_Card, {\n      title: title,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 161,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(_Table, {\n      bordered: true,\n      rowKey: \"_id\",\n      dataSource: users,\n      columns: this.columns,\n      pagination: {\n        defaultPageSize: 2\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 162,\n        columnNumber: 9\n      }\n    }), /*#__PURE__*/React.createElement(_Modal, {\n      title: user._id ? '修改用户' : '添加用户',\n      visible: isShow,\n      onOk: this.addOrUpdateUser,\n      onCancel: () => {\n        this.form.resetFields();\n        this.setState({\n          isShow: false\n        });\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 170,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(UserForm, {\n      setForm: form => this.form = form,\n      roles: roles,\n      user: user,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 179,\n        columnNumber: 11\n      }\n    })));\n  }\n\n}","map":{"version":3,"sources":["D:/studyFiles/前端/react-guli/code/admin-client_final/src/pages/user/user.jsx"],"names":["React","Component","formateDate","LinkButton","reqDeleteUser","reqUsers","reqAddOrUpdateUser","UserForm","User","state","users","roles","isShow","initColumns","columns","title","dataIndex","render","role_id","roleNames","user","showUpdate","deleteUser","initRoleNames","reduce","pre","role","_id","name","showAdd","setState","confirm","username","onOk","result","status","success","getUsers","addOrUpdateUser","form","getFieldsValue","resetFields","data","componentWillMount","componentDidMount","defaultPageSize"],"mappings":"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","sourcesContent":["import React, {Component} from 'react'\nimport {\n  Card,\n  Button,\n  Table,\n  Modal,\n  message\n} from 'antd'\nimport {formateDate} from \"../../utils/dateUtils\"\nimport LinkButton from \"../../components/link-button/index\"\nimport {reqDeleteUser, reqUsers, reqAddOrUpdateUser} from \"../../api/index\";\nimport UserForm from './user-form'\n\n/*\n用户路由\n */\nexport default class User extends Component {\n\n  state = {\n    users: [], // 所有用户列表\n    roles: [], // 所有角色列表\n    isShow: false, // 是否显示确认框\n  }\n\n  initColumns = () => {\n    this.columns = [\n      {\n        title: '用户名',\n        dataIndex: 'username'\n      },\n      {\n        title: '邮箱',\n        dataIndex: 'email'\n      },\n\n      {\n        title: '电话',\n        dataIndex: 'phone'\n      },\n      {\n        title: '注册时间',\n        dataIndex: 'create_time',\n        render: formateDate\n      },\n      {\n        title: '所属角色',\n        dataIndex: 'role_id',\n        render: (role_id) => this.roleNames[role_id]\n      },\n      {\n        title: '操作',\n        render: (user) => (\n          <span>\n            <LinkButton onClick={() => this.showUpdate(user)}>修改</LinkButton>\n            <LinkButton onClick={() => this.deleteUser(user)}>删除</LinkButton>\n          </span>\n        )\n      },\n    ]\n  }\n\n  /*\n  根据role的数组, 生成包含所有角色名的对象(属性名用角色id值)\n   */\n  initRoleNames = (roles) => {\n    const roleNames = roles.reduce((pre, role) => {\n      pre[role._id] = role.name\n      return pre\n    }, {})\n    // 保存\n    this.roleNames = roleNames\n  }\n\n  /*\n  显示添加界面\n   */\n  showAdd = () => {\n    this.user = null // 去除前面保存的user\n    this.setState({isShow: true})\n  }\n\n  /*\n  显示修改界面\n   */\n  showUpdate = (user) => {\n    this.user = user // 保存user\n    this.setState({\n      isShow: true\n    })\n  }\n\n  /*\n  删除指定用户\n   */\n  deleteUser = (user) => {\n    Modal.confirm({\n      title: `确认删除${user.username}吗?`,\n      onOk: async () => {\n        const result = await reqDeleteUser(user._id)\n        if(result.status===0) {\n          message.success('删除用户成功!')\n          this.getUsers()\n        }\n      }\n    })\n  }\n\n  /*\n  添加/更新用户\n   */\n  addOrUpdateUser = async () => {\n\n    this.setState({isShow: false})\n\n    // 1. 收集输入数据\n    const user = this.form.getFieldsValue()\n    this.form.resetFields()\n    // 如果是更新, 需要给user指定_id属性\n    if (this.user) {\n      user._id = this.user._id\n    }\n\n    // 2. 提交添加的请求\n    const result = await reqAddOrUpdateUser(user)\n    // 3. 更新列表显示\n    if(result.status===0) {\n      message.success(`${this.user ? '修改' : '添加'}用户成功`)\n      this.getUsers()\n    }\n  }\n\n  getUsers = async () => {\n    const result = await reqUsers()\n    if (result.status===0) {\n      const {users, roles} = result.data\n      this.initRoleNames(roles)\n      this.setState({\n        users,\n        roles\n      })\n    }\n  }\n\n  componentWillMount () {\n    this.initColumns()\n  }\n\n  componentDidMount () {\n    this.getUsers()\n  }\n\n\n  render() {\n\n    const {users, roles, isShow} = this.state\n    const user = this.user || {}\n\n    const title = <Button type='primary' onClick={this.showAdd}>创建用户</Button>\n\n    return (\n      <Card title={title}>\n        <Table\n          bordered\n          rowKey='_id'\n          dataSource={users}\n          columns={this.columns}\n          pagination={{defaultPageSize: 2}}\n        />\n\n        <Modal\n          title={user._id ? '修改用户' : '添加用户'}\n          visible={isShow}\n          onOk={this.addOrUpdateUser}\n          onCancel={() => {\n            this.form.resetFields()\n            this.setState({isShow: false})\n          }}\n        >\n          <UserForm\n            setForm={form => this.form = form}\n            roles={roles}\n            user={user}\n          />\n        </Modal>\n\n      </Card>\n    )\n  }\n}"]},"metadata":{},"sourceType":"module"}